#!/bin/bash

e="" # Set to echo for dry run

# TODO: Look around this line MMIO32 W 0x10f440 0x22f84f10 PBFB_BROADCAST+0x440 <= 0x22f84f10

$e nvapoke 1548 0x80000102

name=`mktemp`

cat > "${name}" << EOF
0x00000000 0x00000000 0x00000000
0x00000100 0x000000ff 0xffffffff
0x00000200 0x00000055 0x55555555
0x00000300 0x000000aa 0xaaaaaaaa
0x00000400 0x00000033 0x33333333
0x00000500 0x000000cc 0xcccccccc
0x00000600 0x00000000 0xf0f0f0f0
0x00000700 0x000000ff 0x0f0f0f0f
0x00000800 0x000000ff 0x00ff00ff
0x00000900 0x00000000 0xff00ff00
0x00000a00 0x000000ff 0x0000ffff
0x00000b00 0x00000000 0xffff0000
0x00000c00 0x00000000 0x00000000
0x00000d00 0x000000ff 0xffffffff
0x00000e00 0x00000055 0x55555555
0x00000f00 0x000000aa 0xaaaaaaaa
0x00001000 0x00000033 0x33333333
0x00001100 0x000000cc 0xcccccccc
0x00001200 0x00000000 0xf0f0f0f0
0x00001300 0x000000ff 0x0f0f0f0f
0x00001400 0x000000ff 0x00ff00ff
0x00001500 0x00000000 0xff00ff00
0x00001600 0x000000ff 0x0000ffff
0x00001700 0x00000000 0xffff0000
0x00001800 0x00000000 0x00000000
0x00001900 0x000000ff 0xffffffff
0x00001a00 0x00000055 0x55555555
0x00001b00 0x000000aa 0xaaaaaaaa
0x00001c00 0x00000033 0x33333333
0x00001d00 0x000000cc 0xcccccccc
0x00001e00 0x00000000 0xf0f0f0f0
0x00001f00 0x000000ff 0x0f0f0f0f
0x00002000 0x000000ff 0x00ff00ff
0x00002100 0x00000000 0xff00ff00
0x00002200 0x000000ff 0x0000ffff
0x00002300 0x00000000 0xffff0000
0x00002400 0x00000000 0x00000000
0x00002500 0x000000ff 0xffffffff
0x00002600 0x00000055 0x55555555
0x00002700 0x000000aa 0xaaaaaaaa
0x00002800 0x00000033 0x33333333
0x00002900 0x000000cc 0xcccccccc
0x00002a00 0x00000000 0xf0f0f0f0
0x00002b00 0x000000ff 0x0f0f0f0f
0x00002c00 0x000000ff 0x00ff00ff
0x00002d00 0x00000000 0xff00ff00
0x00002e00 0x000000ff 0x0000ffff
0x00002f00 0x00000000 0xffff0000
EOF

while read x y z; do
	$e nvapoke 0x10f968 $x
	$e nvapoke 0x10f96c $x

	$e nvapoke 0x10f920 $(printf 0x%08x $(($y | 0x100)))
	$e nvapoke 0x10f924 $(printf 0x%08x $(($y | 0x100)))

	$e nvapoke 0x10f918 $z
	$e nvapoke 0x10f91c $z

	$e nvapoke 0x10f920 $y
	$e nvapoke 0x10f924 $y

	$e nvapoke 0x10f918 $z
	$e nvapoke 0x10f91c $z
done < "${name}"

rm "${name}"

$e nvapeek 0x132000
$e nvapoke 0x132000 0x18000002
$e nvapoke 0x132000 0x18000000
$e nvapeek 0x132000
$e nvapeek 0x132018

$e nvapeek 0x10fe20
$e nvapeek 0x10fe24
$e nvapoke 0x10fe20 0x20000002
$e nvapoke 0x10fe20 0x20000000

$e nvapeek 0x132020

$e upload

$e nvapoke 0x001548 0x102

